# Описание ключей аргументов WoodWOP Post Processor
>4
## Формат аргументов

Аргументы передаются в поле "Arguments" в настройках Job (вкладка Output).

**Формат:** `/ключ` или `/ключ=значение` (разделяются пробелом)

**Примеры:**
```
/nc /no-comments /precision=4
/workpiece-length=800 /workpiece-width=600 /workpiece-thickness=20
/g54 /nc
```

**Примечание:** Старый формат `--ключ` также поддерживается для обратной совместимости.

---

## Список ключей

### `/nc`
**Описание:** Включает вывод NC (G-code) файла вместе с MPR файлом.

**Поведение:**
- Если ключ **НЕ указан**: создается только MPR файл, NC файл не создается и не появляется в диалоге сохранения
- Если ключ **указан**: создаются оба файла (MPR и NC)

**Примеры:**
```
/nc                    # Создать оба файла: Part_A.mpr и Part_A.nc
/nc /no-comments       # Создать оба файла без комментариев
```

**Когда использовать:**
- Используйте `/nc` когда нужно сравнить MPR и NC форматы для отладки пост-процессора
- Если нужен только MPR файл для станка, не указывайте этот ключ

---

### `/log`
**Описание:** Включает подробное логирование в файл и терминал.

**Поведение:**
- Если ключ **НЕ указан**: выводятся только базовые сообщения отладки
- Если ключ **указан**: выводятся подробные логи о каждом этапе обработки:
  - Детальная информация о каждом обрабатываемом объекте
  - Количество команд в каждом Path
  - Информация о контурах и операциях
  - Используемые инструменты
  - Система координат и смещения
  - Статистика по сгенерированному контенту

**Примеры:**
```
/log                   # Включить подробное логирование
/log /nc                # Логирование + создание обоих файлов
/log /report            # Логирование + создание отчета
```

**Где смотреть логи:**
- Консоль FreeCAD: View → Panels → Report view
- Терминал (если запущен из командной строки)
- Лог-файл: `freecad_postprocess_YYYYMMDD_HHMMSS.log` (создается автоматически)

**Когда использовать:**
- При отладке пост-процессора
- Для проверки корректности обработки данных
- При возникновении проблем с генерацией файлов

---

### `/report`
**Описание:** Включает создание отчета о свойствах Job.

**Поведение:**
- Если ключ **НЕ указан**: отчет не создается
- Если ключ **указан**: создается файл `*_job_report.txt` с подробной информацией:
  - Свойства Job
  - Настройки инструментов
  - Параметры операций
  - Информация о заготовке
  - Система координат

**Примеры:**
```
/report                 # Создать отчет о Job
/report /nc             # Отчет + создание обоих файлов
/report /log            # Отчет + подробное логирование
```

**Формат файла отчета:**
- Имя файла: `{имя_детали}_job_report.txt`
- Расположение: в той же папке, что и выходные файлы
- Формат: текстовый файл с подробной информацией

**Когда использовать:**
- Для проверки корректности настроек Job
- Для документирования параметров обработки
- При отладке проблем с пост-процессором

---

### `/p_c` или `/p-c`
**Описание:** Включает экспорт всех Path Commands из всех операций в текстовый файл.

**Поведение:**
- Если ключ **НЕ указан**: файл с Path Commands не создается
- Если ключ **указан**: создается файл `*_path_commands.txt` с полным списком всех команд пути из всех операций

**Содержимое файла:**
- Информация о каждой операции (имя, тип)
- Полный список всех команд пути для каждой операции
- Параметры каждой команды (X, Y, Z, I, J, и т.д.)
- Нумерация команд для удобства анализа

**Примеры:**
```
/p_c                  # Создать файл с Path Commands
/p_c /nc              # Создать файл с Path Commands и NC файл
/p_c /log             # Создать файл с Path Commands и включить подробное логирование
/p_c /report          # Создать файл с Path Commands и отчет о Job
```

**Формат файла:**
- Имя файла: `{имя_детали}_path_commands.txt`
- Расположение: в той же папке, что и выходные файлы
- Формат: текстовый файл с нумерованными командами

**Когда использовать:**
- Для отладки и анализа команд пути
- Для проверки корректности преобразования команд в MPR формат
- Для сравнения исходных команд с результатом пост-процессора
- При разработке и тестировании пост-процессора

---

### `/no-comments`
**Описание:** Отключает вывод комментариев в MPR файле.

**Поведение:**
- По умолчанию комментарии включены (`KM="..."` строки в MPR файле)
- С этим ключом комментарии не добавляются

**Примеры:**
```
/no-comments                    # Без комментариев
/no-comments /nc                # Без комментариев, с NC файлом
```

---

### `/precision=X`
**Описание:** Устанавливает точность координат (количество знаков после запятой).

**Параметры:**
- `X` - целое число от 1 до 6 (рекомендуется 3)

**Значение по умолчанию:** `3`

**Примеры:**
```
/precision=3        # Точность 3 знака (например: 200.000)
/precision=4        # Точность 4 знака (например: 200.0000)
/precision=2        # Точность 2 знака (например: 200.00)
```

**Рекомендации:**
- Для большинства случаев достаточно `3`
- Для высокоточных операций можно использовать `4` или `5`
- Не рекомендуется использовать больше `6` (избыточная точность)

---

### `/workpiece-length=X`
**Описание:** Устанавливает длину заготовки в миллиметрах (ось X).

**Параметры:**
- `X` - положительное число в миллиметрах

**Значение по умолчанию:** Автоматическое определение из Stock или 800.0 мм

**Примеры:**
```
/workpiece-length=800       # Длина 800 мм
/workpiece-length=1200      # Длина 1200 мм
/workpiece-length=500.5     # Длина 500.5 мм
```

**Когда использовать:**
- Когда нужно переопределить автоматически определенную длину
- Когда Stock не настроен или определен неправильно

---

### `/workpiece-width=Y`
**Описание:** Устанавливает ширину заготовки в миллиметрах (ось Y).

**Параметры:**
- `Y` - положительное число в миллиметрах

**Значение по умолчанию:** Автоматическое определение из Stock или 600.0 мм

**Примеры:**
```
/workpiece-width=600        # Ширина 600 мм
/workpiece-width=900        # Ширина 900 мм
/workpiece-width=400.5      # Ширина 400.5 мм
```

**Когда использовать:**
- Когда нужно переопределить автоматически определенную ширину
- Когда Stock не настроен или определен неправильно

---

### `/workpiece-thickness=Z`
**Описание:** Устанавливает толщину заготовки в миллиметрах (ось Z).

**Параметры:**
- `Z` - положительное число в миллиметрах

**Значение по умолчанию:** Автоматическое определение из Stock или 20.0 мм

**Примеры:**
```
/workpiece-thickness=20     # Толщина 20 мм
/workpiece-thickness=30     # Толщина 30 мм
/workpiece-thickness=18.5   # Толщина 18.5 мм
```

**Когда использовать:**
- Когда нужно переопределить автоматически определенную толщину
- Когда Stock не настроен или определен неправильно

---

### `/use-part-name`
**Описание:** Использовать имя детали/тела вместо имени документа для имени файла.

**Поведение:**
- По умолчанию имя файла формируется из имени детали и имени Job
- С этим ключом приоритет отдается имени детали

**Примеры:**
```
/use-part-name              # Использовать имя детали
/use-part-name /nc          # Использовать имя детали, создать оба файла
```

**Примечание:** В большинстве случаев этот ключ не нужен, так как имя детали используется по умолчанию.

---

### `/g54`
**Описание:** Устанавливает смещение системы координат на минимум координат детали (legacy режим).

**Поведение:**
- При установке этого ключа начало координат (0,0,0) в MPR файле будет находиться в точке минимума детали по X, Y, Z
- Смещение применяется **ТОЛЬКО** к MPR формату
- G-code файл остается без изменений (координаты не смещаются)

**Примеры:**
```
/g54                       # Использовать G54 (минимум координат)
/g54 /nc                   # G54 + создать оба файла
```

**Рекомендация:** 
**ПРЕДПОЧТИТЕЛЬНО** использовать галочку G54 в настройках Job (вкладка Output → Work Coordinate Systems) вместо этого ключа.

**Как работает:**
1. Вычисляется минимум координат детали (минимальные X, Y, Z из всех контуров и операций)
2. Смещение = `-min_x, -min_y, -min_z` (чтобы минимум стал (0,0,0))
3. Все координаты в MPR файле смещаются на это значение
4. G-code файл остается без изменений

**Когда использовать:**
- Когда нужно установить деталь на станке с началом координат в минимуме детали
- Для упрощения настройки станка (не нужно вводить смещения вручную)

---

### `/z_part` или `/z-part`
**Описание:** Использовать Z координаты из Job без коррекции смещением.

**Поведение:**
- По умолчанию: Z координаты корректируются смещением при использовании G54 (или других систем координат)
- С этим ключом: Z координаты используются напрямую из Job без применения смещения `COORDINATE_OFFSET_Z`
- X и Y координаты продолжают корректироваться смещением (если используется G54)
- G-code файл остается без изменений в любом случае

**Примеры:**
```
/z_part                  # Использовать Z из Job без коррекции
/z_part /g54             # G54 только для X и Y, Z из Job
/z_part /nc              # Z из Job + создать оба файла
```

**Как работает:**
1. При использовании G54 вычисляется минимум координат детали
2. Смещение для X и Y: `-min_x, -min_y` (применяется)
3. Смещение для Z: **НЕ применяется** (используются исходные Z из Job)
4. Все Z координаты в MPR файле остаются такими же, как в исходных Path Commands

**Когда использовать:**
- Когда Z координаты в Job уже настроены правильно и не требуют коррекции
- Когда нужно сохранить исходные Z координаты из FreeCAD без изменений
- Когда смещение по Z нежелательно (например, при работе с несколькими уровнями обработки)

**Примечание:** Этот ключ работает только в сочетании с G54 (или другими системами координат). Если G54 не используется, ключ не имеет эффекта, так как смещение и так равно нулю.

---

### `/g0_start` или `/G0_start`
**Описание:** Включает движение холостого хода (G0) в начало контуров.

**Поведение:**
- По умолчанию: движение холостого хода не добавляется в начало контуров (станок сам идет к началу обработки)
- С этим ключом: последняя позиция G0 перед первым G1/G2/G3 используется для формирования начального движения холостого хода в контуре
- Движение G0 добавляется как первый элемент контура (перед $E1)
- В WoodWOP формате G0 движение представляется как элемент KL (линия) с комментарием "G0 Rapid Move to Start"

**Примеры:**
```
/g0_start                  # Включить G0 движение в начало контуров
/g0_start /nc              # G0 движение + создать оба файла
/g0_start /g54             # G0 движение + G54 смещение
```

**Как работает:**
1. При обработке Path команд отслеживается последняя позиция G0 перед первым G1/G2/G3
2. Эта позиция сохраняется в переменной `LAST_G0_POSITION`
3. При формировании контура, если включен `/g0_start` и есть сохраненная позиция G0, добавляется элемент G0 движения
4. Элемент G0 представляет движение от последней позиции G0 к началу обработки (первому элементу контура)

**Когда использовать:**
- Когда нужно явно указать движение холостого хода в начале каждого контура
- Когда станок требует явного указания G0 движения перед началом обработки
- Для совместимости с определенными станками WoodWOP, которые требуют явного G0 движения

**Примечание:** Без этого ключа станок сам перемещается к началу обработки. С ключом движение G0 явно указывается в MPR файле.

---

## Комбинированные примеры

### Базовый пример (только MPR файл)
```
(пусто)
```

### Отладка и анализ
```
/p_c /nc /log /report    # Полный набор для отладки: Path Commands, NC файл, логирование, отчет
/p_c /log                # Path Commands + подробное логирование
/p_c /report             # Path Commands + отчет о Job
```
Создается только `Part_A.mpr` файл.

### Сравнение форматов (MPR + NC)
```
/nc
```
Создаются оба файла: `Part_A.mpr` и `Part_A.nc`

### Высокая точность без комментариев
```
/precision=4 /no-comments
```
MPR файл с точностью 4 знака, без комментариев.

### Полная настройка заготовки
```
/workpiece-length=1000 /workpiece-width=800 /workpiece-thickness=25
```
MPR файл с указанными размерами заготовки.

### G54 с NC файлом для сравнения
```
/g54 /nc
```
MPR файл с G54 смещением + NC файл для сравнения.

### G54 только для X и Y, Z из Job
```
/z_part /g54
```
MPR файл с G54 смещением только для X и Y, Z координаты используются из Job без коррекции.

### G0 движение в начало контуров
```
/g0_start
```
MPR файл с явным G0 движением холостого хода в начале каждого контура.

### Полный пример
```
/nc /no-comments /precision=4 /workpiece-length=1200 /workpiece-width=900 /workpiece-thickness=30 /g54
```
Все настройки вместе.

### Отладка с полным логированием и отчетом
```
/log /report /nc
```
Подробное логирование + отчет + оба файла для полной диагностики.

### Отладка с Path Commands
```
/p_c /nc /log /report
```
Полный набор для отладки: Path Commands, NC файл, логирование, отчет о Job.

---

## Приоритет настроек

1. **Размеры заготовки:**
   - Если указаны ключи `/workpiece-length`, `/workpiece-width`, `/workpiece-thickness` → используются они
   - Если не указаны → автоматическое определение из Stock
   - Если Stock не настроен → значения по умолчанию (800x600x20)

2. **Система координат G54:**
   - **Приоритет 1:** Галочка G54 в Job → Work Coordinate Systems
   - **Приоритет 2:** Ключ `/g54` (legacy режим)
   - Если ничего не указано → используется система координат проекта (без смещения)
   
3. **Коррекция Z координат:**
   - Если указан ключ `/z_part`: Z координаты используются из Job без смещения
   - Если не указан: Z координаты корректируются смещением вместе с X и Y (при использовании G54)

4. **Имя файла:**
   - **Приоритет 1:** Имя детали + имя Job (например: `Part_A.mpr`)
   - **Приоритет 2:** Имя из PostProcessorOutputFile (если указан полный путь)
   - **Приоритет 3:** Имя документа

---

## Часто задаваемые вопросы

### Q: Как создать только MPR файл без NC?
**A:** Не указывайте ключ `/nc`. По умолчанию создается только MPR файл.

### Q: Как включить вывод обоих файлов?
**A:** Добавьте ключ `/nc` в аргументы.

### Q: Как использовать G54?
**A:** Отметьте галочку G54 в Job → Output → Work Coordinate Systems (предпочтительно) или используйте ключ `/g54`.

### Q: Почему координаты в MPR и NC файлах разные?
**A:** Это нормально. При использовании G54 смещение применяется только к MPR файлу. NC файл остается без изменений для сравнения.

### Q: Как изменить точность координат?
**A:** Используйте ключ `/precision=X`, где X - количество знаков после запятой (1-6).

### Q: Можно ли комбинировать ключи?
**A:** Да, все ключи можно комбинировать, разделяя их пробелом.

### Q: Как использовать Z координаты из Job без коррекции?
**A:** Используйте ключ `/z_part`. При этом X и Y будут корректироваться смещением (если используется G54), а Z останется без изменений.

### Q: Как включить G0 движение в начало контуров?
**A:** Используйте ключ `/g0_start`. При этом последняя позиция G0 перед первым G1/G2/G3 будет использована для формирования начального движения холостого хода в контуре.

---

## Технические детали

### Формат аргументов
- Новый формат: `/ключ` или `/ключ=значение`
- Старый формат: `--ключ` или `--ключ=значение` (поддерживается для обратной совместимости)
- Разделитель: пробел

### Кодировка файлов
- MPR файлы: ANSI (Windows-1252 / cp1252) с CRLF окончаниями строк
- NC файлы: UTF-8 с системными окончаниями строк

### Расширения файлов
- MPR файлы: `.mpr`
- NC файлы: `.nc`
- Отчеты: `_job_report.txt`
- Path Commands: `_path_commands.txt`
- Логи: `freecad_postprocess_YYYYMMDD_HHMMSS.log`

---

## История изменений

- **v0.16+**: Ключ `/g0_start` для включения движения холостого хода в начало контуров
- **v0.15+**: Ключ `/z_part` для использования Z координат из Job без коррекции
- **v0.14+**: Ключ `/p_c` для экспорта Path Commands в файл
- **v0.13+**: Ключ `/log` для подробного логирования
- **v0.13+**: Ключ `/report` для управления созданием отчета
- **v0.12+**: Новый формат ключей `/` вместо `--`
- **v0.12+**: Ключ `/nc` для управления выводом NC файла
- **v0.12**: Поддержка G54 через Job.Fixtures (галочка в интерфейсе)
- **v0.11**: ANSI кодировка для MPR файлов с CRLF окончаниями строк
- **v0.010**: Правильные имена файлов на основе имени детали и Job

---

## Поддержка

При возникновении проблем проверьте:
1. Лог-файл: `freecad_postprocess_YYYYMMDD_HHMMSS.log`
2. Консоль FreeCAD: View → Panels → Report view
3. Отчет Job: `*_job_report.txt`
4. Path Commands: `*_path_commands.txt` (если использован ключ `/p_c`)

