# WoodWOP Post Processor - Модульная структура

## Структура модулей

```
woodwop/
├── __init__.py           # Инициализация пакета
├── config.py             # Глобальные переменные и константы
├── utils.py              # Вспомогательные функции (debug_log, fmt, linenumber)
├── argument_parser.py    # Парсинг аргументов командной строки
├── path_parser.py        # Извлечение контуров и операций из Path команд
├── geometry.py           # Геометрические расчеты (углы, границы, компенсация)
├── job_processor.py      # Обработка Job и создание операций
├── mpr_generator.py      # Генерация MPR контента
├── gcode_generator.py    # Генерация G-code
├── report_generator.py   # Генерация отчетов
├── export_handler.py     # Обработка экспорта Path команд
└── woodwop_post.py       # Главный файл с функцией export()
```

## Текущий статус

✅ **Создано:**
- `__init__.py` - инициализация пакета
- `config.py` - все глобальные переменные и константы
- `utils.py` - вспомогательные функции
- `woodwop_post.py` - главный файл (базовая структура)

⏳ **В процессе:**
- Остальные модули будут созданы по мере рефакторинга

## Использование

Главный файл `woodwop_post.py` можно использовать как обычный пост-процессор FreeCAD.
Он автоматически использует модульную структуру, если все модули доступны,
или возвращается к оригинальной реализации для обратной совместимости.

## Преимущества модульной структуры

1. **Независимость от версии FreeCAD** - модули можно обновлять отдельно
2. **Легкое тестирование** - каждый модуль можно тестировать отдельно
3. **Упрощенная поддержка** - функции сгруппированы по назначению
4. **Переиспользование** - модули можно использовать в других проектах

## Обработка G0 команд (rapid moves)

### Логика обработки G0

**Флаг `--use_g0` или `/use_g0`:**

- **Если флаг УСТАНОВЛЕН**: ВСЕ G0 команды обрабатываются как G1 (линейные перемещения) и добавляются в контур
- **Если флаг НЕ УСТАНОВЛЕН (по умолчанию)**: Цепочки G0 в начале и конце траектории ПРОПУСКАЮТСЯ:
  - G0 команды до первого рабочего элемента (G1/G2/G3) пропускаются (только обновляется позиция)
  - G0 команды после последнего рабочего элемента (G1/G2/G3) пропускаются (только обновляется позиция)
  - G0 команды МЕЖДУ рабочими элементами обрабатываются как G1 (являются частью контура)

### Пример

```
Последовательность команд: [G0, G0, G1, G0, G2, G0, G0]
                          [пропуск] [работа] [G0 между] [работа] [пропуск]

Без флага --use_g0:
  - G0 в начале (до G1) → пропускаются
  - G0 между G1 и G2 → обрабатываются как G1 (часть контура)
  - G0 в конце (после G2) → пропускаются

С флагом --use_g0:
  - ВСЕ G0 → обрабатываются как G1
```

### Зачем это нужно?

FreeCAD генерирует подходные/отводные перемещения (G0), которые не должны быть включены в контур, так как WoodWOP обрабатывает их автоматически. Однако G0 между рабочими элементами являются частью контура и должны обрабатываться.



