# WoodWOP Post Processor for FreeCAD

Post-processor для FreeCAD Path Workbench, который конвертирует операции обработки в формат WoodWOP MPR 4.0 для станков HOMAG CNC.

## Возможности

- ✅ Генерация файлов в формате WoodWOP MPR 4.0
- ✅ Параллельная генерация G-code для сравнения
- ✅ Автоматическое именование файлов на основе имени детали и Job
- ✅ Автоматическая генерация отчета о проекте
- ✅ Поддержка контуров, сверления и карманов
- ✅ Автоматическое определение размеров заготовки
- ✅ Модульная архитектура для легкой поддержки

## Установка

### Метод 1: Установка в системную директорию (Рекомендуется)

#### macOS:
```bash
sudo cp -r "woodwop" "/Applications/FreeCAD.app/Contents/Resources/Mod/CAM/Path/Post/scripts/"
```

#### Linux:
```bash
sudo cp -r "woodwop" "/usr/share/FreeCAD/Mod/CAM/Path/Post/scripts/"
```

### Метод 2: Установка в пользовательскую директорию

1. Создайте директорию для постпроцессоров:
```bash
mkdir -p "$HOME/Documents/FreeCAD_PostProcessors"
```

2. Скопируйте папку woodwop:
```bash
cp -r "woodwop" "$HOME/Documents/FreeCAD_PostProcessors/"
```

3. В FreeCAD: **Edit → Preferences → CAM → Job Preferences**
   - Добавьте путь к постпроцессорам в **User Post Processor Path**

4. Перезапустите FreeCAD

## Использование

1. Создайте Job в FreeCAD Path Workbench
2. Добавьте операции обработки (Profile, Pocket, Drilling и т.д.)
3. Выберите постпроцессор **woodwop** в настройках Job
4. Выполните **Path → Post Process**
5. Подтвердите имена файлов в диалоге

## Выходные файлы

Постпроцессор создает файлы:

1. **`{PartName}_{JobName}.mpr`** - Основной файл в формате WoodWOP MPR 4.0
2. **`{PartName}_{JobName}.nc`** - G-code файл для сравнения (если указан флаг `--nc`)
3. **`{PartName}_{JobName}_job_report.txt`** - Отчет о свойствах Job (если указан флаг `--report`)

## Структура модулей

```
woodwop/
├── __init__.py              # Инициализация модуля + dev mode
├── woodwop_post.py          # Entry point для FreeCAD
├── woodwop_post_impl.py     # Главная реализация export()
│
├── config.py                # Глобальные переменные и константы
├── utils.py                 # Вспомогательные функции
│
├── argument_parser.py      # Парсинг аргументов командной строки
├── path_parser.py          # Извлечение контуров из Path команд
├── geometry.py             # Геометрические расчеты
├── job_processor.py        # Обработка FreeCAD Job объектов
│
├── mpr_generator.py        # Генерация MPR контента
├── gcode_generator.py      # Генерация G-code
├── report_generator.py     # Генерация отчетов
├── export_handler.py       # Экспорт Path команд
├── file_writer.py          # Запись файлов с CRLF
│
├── command_patch.py        # Monkey patch для Command.py
├── dialog_patch.py         # Patch для file dialog (disabled)
├── woodwop_file_dialog.py  # Кастомный file dialog
│
├── README.md               # Этот файл
├── USAGE_GUIDE.md          # Руководство по использованию
├── ARGUMENTS.md            # Описание всех аргументов
├── CHANGELOG.md            # История изменений
├── CURSOR_DEVELOPMENT_GUIDE.md  # Руководство для разработчиков
├── DEV_MODE_README.md      # Режим разработки
│
├── .dev_mode               # Маркер dev mode (опционально)
└── .gitignore              # Git ignore rules
```

## Обработка G0 команд (rapid moves)

### Логика обработки G0

**Флаг `--use_g0` или `/use_g0`:**

- **Если флаг УСТАНОВЛЕН**: ВСЕ G0 команды обрабатываются как G1 (линейные перемещения) и добавляются в контур
- **Если флаг НЕ УСТАНОВЛЕН (по умолчанию)**: Цепочки G0 в начале и конце траектории ПРОПУСКАЮТСЯ:
  - G0 команды до первого рабочего элемента (G1/G2/G3) пропускаются (только обновляется позиция)
  - G0 команды после последнего рабочего элемента (G1/G2/G3) пропускаются (только обновляется позиция)
  - G0 команды МЕЖДУ рабочими элементами обрабатываются как G1 (являются частью контура)

### Пример

```
Последовательность команд: [G0, G0, G1, G0, G2, G0, G0]
                          [пропуск] [работа] [G0 между] [работа] [пропуск]

Без флага --use_g0:
  - G0 в начале (до G1) → пропускаются
  - G0 между G1 и G2 → обрабатываются как G1 (часть контура)
  - G0 в конце (после G2) → пропускаются

С флагом --use_g0:
  - ВСЕ G0 → обрабатываются как G1
```

### Зачем это нужно?

FreeCAD генерирует подходные/отводные перемещения (G0), которые не должны быть включены в контур, так как WoodWOP обрабатывает их автоматически. Однако G0 между рабочими элементами являются частью контура и должны обрабатываться.

## Требования

- FreeCAD 1.2.0 или выше
- Python 3.10 или выше
- Path Workbench (встроен в FreeCAD)

## Документация

- **[USAGE_GUIDE.md](USAGE_GUIDE.md)** - Подробное руководство по использованию
- **[ARGUMENTS.md](ARGUMENTS.md)** - Описание всех аргументов командной строки
- **[CHANGELOG.md](CHANGELOG.md)** - История изменений
- **[CURSOR_DEVELOPMENT_GUIDE.md](CURSOR_DEVELOPMENT_GUIDE.md)** - Руководство для разработчиков
- **[DEV_MODE_README.md](DEV_MODE_README.md)** - Режим разработки и очистка кэша

## Лицензия

Этот постпроцессор распространяется под той же лицензией, что и FreeCAD (LGPL 2.1+).

## Поддержка

Для вопросов и предложений создавайте Issues в репозитории.

---

**Примечание:** Этот постпроцессор находится в активной разработке. Пожалуйста, проверяйте выходные файлы перед использованием на станке.